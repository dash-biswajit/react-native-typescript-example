matrix:
  include:
    - language: android
      os: linux
      jdk: oraclejdk8
      before_cache:
        - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      sudo: required
      node_js: false
      before_install:
        - nvm install 8
        - node --version
        - travis_retry curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
        - echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
        - travis_retry sudo apt-get update -qq
        - travis_retry sudo apt-get install -y -qq yarn
      install:
        - yarn
      android: 
      components: 
        - tools
        - platform-tools
        - build-tools-23.0.3
        - android-23
        - extra-android-m2repository
        - extra-android-support
        - sys-img-armeabi-v7a-android-23
        - extra-google-google_play_services
  licenses: 
        - android-sdk-preview-license-52d11cd2
        - android-sdk-license-c81a61d9
        - android-sdk-license-.+
        - google-gdk-license-.+
  before_script:
    - echo no | android create avd --force -n test -t android-23 --abi armeabi-v7a
    - emulator -avd test -no-skin -no-audio -no-window &
    - android-wait-for-emulator
    - adb shell input keyevent 82 &
  before_cache: 
    - "rm -f $HOME/.gradle/caches/modules-2/modules-2.lock"
  before_install: 
    - "chmod +x gradlew
  script:
    - cd android && ./gradlew assembleDebug && ./gradlew assembleRelease
